; Filename: myexecve-stack.nasm
; Author:  Vivek, Stavros
; Website:  http://securitytube.net
; Training: http://securitytube-training.com 
;
;
; Purpose: 

global _start			

section .text
_start:

	;we will first start with 4 mull butes pushed on the stack
	xor eax,eax
	push eax
	
	;then we need to push the ////bin/bash command on the stack
	;use reverse.py to reverse it. We are using multiple slashes to allign
	;the values to 4 byte multiples
	push 0x68736162
	push 0x2f6e6962
	push 0x2f2f2f2f

	;store the pointer to the command we want to execute into EBX, 
	;per execve requirements
	mov ebx, esp
	
	;next on the stack should be the envp pointer, again 4 null bytes
	;we can again use eax. This value must be stored in EDX per execve reqs.
	push eax
	mov edx, esp
	
	;next on the stack we should have the ADDDRESS to the command we want
	;to execute. Since we have not modified EBX, this is the reg that stores it.
	;this must be stored into ECX
	push ebx
	mov ecx, esp
	
	;we are no ready to execute the syscall
	mov al, 0xb
	int 0x80
	